---
import EventCard from '../ui/EventCard.astro';

interface Event {
  title: string;
  image: string;
  slug?: string;
  location?: string;
}

interface Props {
  events: Event[];
  pastEvents?: Event[];
  archiveYears?: string[];
}

const { events, pastEvents = [], archiveYears = [] } = Astro.props;
---

<section class="events-section">
  <div class="container">
    <header class="section-header">
      <div class="tabs">
        <button class="tab active" data-tab="upcoming">Prossimi Eventi</button>
        <button class="tab" data-tab="past">Eventi Passati</button>
      </div>
    </header>

    <div class="events-content">
      <div class="events-grid" id="upcoming-events">
        {events.map((event) => (
          <EventCard
            title={event.title}
            image={event.image}
            slug={event.slug}
            location={event.location}
          />
        ))}
      </div>

      <div class="events-grid hidden" id="past-events">
        {pastEvents.length > 0 ? (
          pastEvents.map((event) => (
            <EventCard
              title={event.title}
              image={event.image}
              slug={event.slug}
              location={event.location}
            />
          ))
        ) : (
          <p class="no-events">Nessun evento passato disponibile.</p>
        )}
      </div>

      {archiveYears.length > 0 && (
        <div class="archive-section hidden" id="archive-section">
          <div class="archive-header">
            <h3 class="archive-title">Archivio</h3>
          </div>
          <div class="archive-buttons">
            {archiveYears.map((year) => (
              <a href={`/archivio/${year}`} class="archive-btn">{year}</a>
            ))}
          </div>
        </div>
      )}
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tab');
    const upcomingGrid = document.getElementById('upcoming-events');
    const pastGrid = document.getElementById('past-events');
    const archiveSection = document.getElementById('archive-section');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active from all tabs
        tabs.forEach(t => t.classList.remove('active'));
        // Add active to clicked tab
        tab.classList.add('active');

        const tabType = tab.getAttribute('data-tab');

        if (tabType === 'upcoming') {
          upcomingGrid?.classList.remove('hidden');
          pastGrid?.classList.add('hidden');
          archiveSection?.classList.add('hidden');
        } else {
          upcomingGrid?.classList.add('hidden');
          pastGrid?.classList.remove('hidden');
          archiveSection?.classList.remove('hidden');
        }
      });
    });
  });
</script>

<style>
  .events-section {
    padding: var(--space-3xl) 0;
  }

  .events-section .container {
    padding-left: var(--container-padding);
    padding-right: var(--container-padding);
  }

  .section-header {
    margin-bottom: var(--space-2xl);
  }

  .tabs {
    display: flex;
    gap: var(--space-md);
  }

  .tab {
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    font-weight: 700;
    background: none;
    border: none;
    padding: var(--space-sm) 0;
    cursor: pointer;
    color: var(--color-gray);
    transition: color 0.2s ease;
    border-radius: 0;
  }

  .tab:hover {
    color: var(--color-black);
    background: none;
  }

  .tab.active {
    color: var(--color-black);
  }

  .events-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--space-xl);
  }

  .events-grid.hidden {
    display: none;
  }

  .no-events {
    grid-column: span 2;
    text-align: center;
    color: var(--color-gray);
    padding: var(--space-3xl) 0;
  }

  .archive-section {
    margin-top: var(--space-3xl);
    padding-top: var(--space-2xl);
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .archive-section.hidden {
    display: none;
  }

  .archive-title {
    font-size: var(--text-2xl);
    font-weight: 700;
    margin-bottom: var(--space-xl);
  }

  .archive-buttons {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
  }

  .archive-btn {
    display: inline-block;
    padding: var(--space-sm) var(--space-xl);
    background: var(--color-black);
    color: var(--color-white);
    text-decoration: none;
    font-weight: 600;
    font-size: var(--text-lg);
    border-radius: 9999px;
    transition: background 0.2s ease;
  }

  .archive-btn:hover {
    background: var(--color-accent);
    opacity: 1;
  }

  @media (max-width: 768px) {
    .events-section {
      padding: var(--space-2xl) 0;
    }

    .section-header {
      margin-bottom: var(--space-xl);
    }

    .tabs {
      gap: var(--space-lg);
    }

    .tab {
      font-size: var(--text-xl);
    }

    .events-grid {
      grid-template-columns: 1fr;
      gap: var(--space-lg);
    }

    .no-events {
      grid-column: span 1;
    }
  }
</style>
