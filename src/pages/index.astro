---
import BaseLayout from '../components/layout/BaseLayout.astro';
import Hero from '../components/sections/Hero.astro';
import EventGrid from '../components/sections/EventGrid.astro';
import Newsletter from '../components/sections/Newsletter.astro';
import { getCollection } from 'astro:content';
import siteSettings from '../content/settings/site.json';

// Carica eventi dal CMS
const allEvents = await getCollection('eventi');
const publishedEvents = allEvents.filter(e => e.data.published);

// Separa eventi futuri e passati
const events = publishedEvents
  .filter(e => !e.data.isPast)
  .map(e => ({
    title: e.data.title,
    image: e.data.image,
    slug: e.slug,
    location: e.data.location
  }));

// Eventi passati (max 6)
const pastEvents = publishedEvents
  .filter(e => e.data.isPast)
  .slice(0, 6)
  .map(e => ({
    title: e.data.title,
    image: e.data.image,
    slug: e.slug,
    location: e.data.location
  }));

// Estrai anni unici dagli eventi passati per la sezione archivio
const archiveYears = [...new Set(
  publishedEvents
    .filter(e => e.data.isPast)
    .map(e => e.data.year)
)].sort((a, b) => Number(b) - Number(a));
---

<BaseLayout
  title="La Festa delle Medie"
  description="Un progetto culturale che unisce arte, musica e comunita"
>
  <Hero useGradient={false} image="/images/img 4.jpg" />

  <div class="content-below-hero">
    <div class="content-wrapper">
      <EventGrid
        events={events}
        pastEvents={pastEvents}
        archiveYears={archiveYears}
      />

      <Newsletter />
    </div>
  </div>
</BaseLayout>

<style>
  .content-below-hero {
    position: relative;
    z-index: 2;
    padding-top: 100vh;
  }

  .content-wrapper {
    background: var(--color-white);
  }
</style>
